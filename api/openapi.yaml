---
openapi: 3.0.0
info:
  title: Nori Authentication
  license:
    name: Apache 2.0
  version: 1.0.0
servers:
- url: http://localhost:8080
paths:
  /signup:
    post:
      summary: Add a new user
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
            encoding:
              login:
                style: form
                allowReserved: true
              password:
                style: form
                allowReserved: true
        required: true
      responses:
        "201":
          description: Created
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /signin:
    post:
      summary: authentication start user session
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignInRequest'
            encoding:
              email:
                style: form
                allowReserved: true
              password:
                style: form
                allowReserved: true
        required: true
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignInResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /signout:
    get:
      summary: send token to logout
      operationId: signOut
      parameters:
      - name: ssid
        in: cookie
        description: user session id
        required: true
        style: form
        explode: true
        schema:
          type: string
      responses:
        "200":
          description: Ok
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /password/restore:
    get:
      summary: check token for timeout
      operationId: restorePasswordCheckToken
      parameters:
      - name: ssid
        in: cookie
        description: user session id
        required: true
        style: form
        explode: true
        schema:
          type: string
      responses:
        "200":
          description: Ok
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: save password
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RestorePasswordSetRequest'
            encoding:
              password:
                style: form
                allowReserved: true
        required: true
      responses:
        "200":
          description: Ok
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: receive token to email
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RestorePasswordRequest'
            encoding:
              email:
                style: form
                allowReserved: true
        required: true
      responses:
        "200":
          description: Ok
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /password:
    post:
      summary: restore acting password
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordSetRequest'
            encoding:
              passwordOld:
                style: form
                allowReserved: true
              passwordNew:
                style: form
                allowReserved: true
        required: true
      responses:
        "200":
          description: Ok
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /mfa/recovery_codes:
    put:
      summary: generate and update recovery codes
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecoveryCodes'
        required: true
      responses:
        "200":
          description: Ok
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: generate and save recovery codes
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecoveryCodes'
        required: true
      responses:
        "200":
          description: Ok
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /mfa/recovery_codes/download:
    get:
      summary: download recovery codes
      operationId: recoveryCodes
      parameters:
      - name: user_id
        in: query
        description: id of user
        required: true
        style: form
        explode: true
        schema:
          type: string
      responses:
        "200":
          description: A file with recovery codes
          content:
            text/plain:
              schema:
                type: string
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /settings/profile:
    get:
      summary: receive user's information
      operationId: userProfile
      parameters:
      - name: ssid
        in: cookie
        description: user session id
        required: true
        style: form
        explode: true
        schema:
          type: string
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: update user's information
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Profile'
        required: true
      responses:
        "200":
          description: Ok
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /settings/security:
    get:
      summary: receive mfa status
      operationId: mfaStatus
      parameters:
      - name: ssid
        in: cookie
        description: user session id
        required: true
        style: form
        explode: true
        schema:
          type: string
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Mfa'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: update mfa status
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Mfa'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/Mfa'
        required: true
      responses:
        "200":
          description: Ok
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /settings/mfa/verify:
    get:
      summary: get secret
      operationId: mfaSecret
      parameters:
      - name: ssid
        in: cookie
        description: user session id
        required: true
        style: form
        explode: true
        schema:
          type: string
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Secret'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: enter six-digit code
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Code'
        required: true
      responses:
        "200":
          description: Ok
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /sessions/mfa:
    put:
      summary: send code
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Code'
        required: true
      responses:
        "200":
          description: Ok
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
components:
  schemas:
    RecoveryCodes:
      type: array
      items:
        type: string
    RestorePasswordRequest:
      required:
      - actionCaptcha
      - login
      - tokenCaptcha
      type: object
      properties:
        login:
          type: string
        tokenCaptcha:
          type: string
        actionCaptcha:
          type: string
    RestorePasswordSetRequest:
      required:
      - email
      - password
      - token
      type: object
      properties:
        email:
          type: string
        token:
          type: string
        password:
          type: string
    PasswordSetRequest:
      required:
      - passwordNew
      - passwordOld
      - token
      type: object
      properties:
        email:
          type: string
        token:
          type: string
        password:
          type: string
    Profile:
      required:
      - email
      type: object
      properties:
        email:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        nickName:
          type: string
        bio:
          type: string
        url:
          type: string
        company:
          type: string
        location:
          type: string
    SignInRequest:
      required:
      - login
      - password
      type: object
      properties:
        login:
          type: string
        password:
          type: string
    SignInResponse:
      required:
      - token
      type: object
      properties:
        token:
          type: string
    SignUpRequest:
      required:
      - actionCaptcha
      - login
      - password
      - tokenCaptcha
      type: object
      properties:
        login:
          type: string
        password:
          type: string
        tokenCaptcha:
          type: string
        actionCaptcha:
          type: string
    Mfa:
      required:
      - status
      type: object
      properties:
        status:
          type: boolean
    Secret:
      required:
      - secret
      type: object
      properties:
        secret:
          type: string
    Code:
      required:
      - code
      type: object
      properties:
        code:
          type: string
    Error:
      required:
      - code
      - errors
      type: object
      properties:
        code:
          type: string
        errors:
          type: array
          items:
            $ref: '#/components/schemas/Error_errors'
    Error_errors:
      type: object
      properties:
        field:
          type: string
        message:
          type: string
