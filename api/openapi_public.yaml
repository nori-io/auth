---
openapi: 3.0.0
info:
  title: Nori Authentication
  license:
    name: Apache 2.0
  version: 1.0.0
servers:
- url: http://localhost:8080
paths:
  /auth/login:
    post:
      summary: authentication start user session
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogInRequest'
            encoding:
              email:
                style: form
                allowReserved: true
              password:
                style: form
                allowReserved: true
        required: true
      responses:
        "200":
          description: User signed in
          headers:
            Set-Cookie:
              style: simple
              explode: false
              schema:
                type: string
                description: set session's cookie of session for identification of users
                example: ssid=abcde12345; Path=/; HttpOnly
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogInResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/login/mfa:
    post:
      summary: enter authentication code in second step of two-factor authentication
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogInMfaRequest'
        required: true
      responses:
        "200":
          description: User log in
          headers:
            Set-Cookie:
              style: simple
              explode: false
              schema:
                type: string
                description: set session's cookie of session for identification of users
                example: ssid=abcde12345; Path=/; HttpOnly
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogInMfaResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "401":
          description: UnauthorizedError
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - cookieAuth: []
  /auth/logout:
    get:
      summary: send token to logout
      operationId: logOut
      responses:
        "302":
          description: redirect
          headers:
            Location:
              description: URI where the client will be redirected
              style: simple
              explode: false
              schema:
                type: string
                format: uri
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - cookieAuth: []
  /auth/password/restore:
    put:
      summary: save password
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RestorePasswordSetRequest'
            encoding:
              password:
                style: form
                allowReserved: true
        required: true
      responses:
        "200":
          description: Ok
          headers:
            Set-Cookie:
              style: simple
              explode: false
              schema:
                type: string
                description: set session's cookie of session for identification of users
                example: ssid=abcde12345; Path=/; HttpOnly
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestorePasswordPutResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: receive token to email/phone
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RestorePasswordRequest'
            encoding:
              email:
                style: form
                allowReserved: true
        required: true
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestorePasswordPostResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/session:
    get:
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionResponse'
        "401":
          description: UnauthorizedError
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - cookieAuth: []
  /auth/settings/mfa:
    get:
      summary: get mfa status
      operationId: getMfaStatus
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MfaStatusResponse'
        "401":
          description: UnauthorizedError
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - cookieAuth: []
  /auth/settings/mfa/disable:
    post:
      summary: disable mfa
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DisableResponse'
        "401":
          description: UnauthorizedError
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - cookieAuth: []
  /auth/settings/mfa/otp:
    get:
      summary: get generated secret from backend, email and issuer
      operationId: barCodeGenerating
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OtpResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "401":
          description: UnauthorizedError
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - cookieAuth: []
  /auth/settings/mfa/recovery_codes:
    get:
      summary: get generated recovery codes
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MfaRecoveryCodesResponse'
        "401":
          description: UnauthorizedError
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - cookieAuth: []
  /auth/settings/mfa/sms:
    post:
      summary: send Sms via services
      operationId: sendingSms
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SmsRequest'
            encoding:
              login:
                style: form
                allowReserved: true
              password:
                style: form
                allowReserved: true
        required: true
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SmsResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "401":
          description: UnauthorizedError
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - cookieAuth: []
  /auth/settings/mfa/verify:
    post:
      summary: enter six-digit code from app or sms and turn on mfa
      operationId: verifyingCode
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MfaVerifyRequest'
        required: true
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifyResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "401":
          description: UnauthorizedError
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - cookieAuth: []
  /auth/settings/password:
    post:
      summary: change actual password
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordChangeRequest'
            encoding:
              passwordOld:
                style: form
                allowReserved: true
              passwordNew:
                style: form
                allowReserved: true
        required: true
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordChangeResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - cookieAuth: []
  /auth/signup:
    post:
      summary: Create a new user
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
            encoding:
              email:
                style: form
                allowReserved: true
              password:
                style: form
                allowReserved: true
        required: true
      responses:
        "201":
          description: User's account created
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "409":
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/social/{social_provider}:
    get:
      parameters:
      - name: social_provider
        in: path
        description: social_provider
        required: true
        style: simple
        explode: false
        schema:
          type: string
      responses:
        "302":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SocialResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/social/{social_provider}/callback:
    post:
      parameters:
      - name: social_provider
        in: path
        description: social_provider
        required: true
        style: simple
        explode: false
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CallbackRequest'
        required: true
      responses:
        "200":
          description: Ok
          headers:
            Set-Cookie:
              style: simple
              explode: false
              schema:
                type: string
                description: set session's cookie of session for identification of users
                example: ssid=abcde12345; Path=/; HttpOnly
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CallbackResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "401":
          description: UnauthorizedError
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/social/{social_provider}/logout:
    get:
      parameters:
      - name: social_provider
        in: path
        description: social_provider
        required: true
        style: simple
        explode: false
        schema:
          type: string
      responses:
        "200":
          description: User signed out from social provider
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - cookieAuth: []
components:
  schemas:
    CallbackRequest:
      required:
      - access_token
      - expires_in
      - info
      - refresh_token
      - token_type
      - uid
      type: object
      properties:
        access_token:
          type: string
        token_type:
          type: string
        expires_in:
          type: number
          format: int64
        refresh_token:
          type: string
        uid:
          type: number
          format: int64
        info:
          type: string
    CallbackResponse:
      required:
      - isExistSocialAccount
      - isSocialAccountBoundedEarlier
      - message
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        isExistSocialAccount:
          type: boolean
        isSocialAccountBoundedEarlier:
          type: boolean
    DisableResponse:
      required:
      - message
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
    ErrorResponse:
      required:
      - code
      - errors
      type: object
      properties:
        code:
          type: string
        errors:
          type: array
          items:
            $ref: '#/components/schemas/ErrorResponse_errors'
    LogInRequest:
      required:
      - email
      - password
      type: object
      properties:
        email:
          type: string
        password:
          type: string
    LogInResponse:
      required:
      - message
      - mfaType
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        mfaType:
          type: string
    LogInMfaRequest:
      required:
      - code
      type: object
      properties:
        code:
          type: string
    LogInMfaResponse:
      required:
      - message
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
    MfaStatusResponse:
      required:
      - message
      - status
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        status:
          type: boolean
    MfaRecoveryCodesResponse:
      required:
      - message
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        codes:
          type: array
          items:
            type: string
    MfaVerifyRequest:
      required:
      - code
      type: object
      properties:
        code:
          type: string
    OtpResponse:
      required:
      - email
      - issuer
      - message
      - secret
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        email:
          type: string
        issuer:
          type: string
        secret:
          type: string
    PasswordChangeRequest:
      required:
      - passwordNew
      - passwordOld
      type: object
      properties:
        passwordOld:
          type: string
        passwordNew:
          type: string
    PasswordChangeResponse:
      required:
      - message
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
    RestorePasswordRequest:
      required:
      - actionCaptcha
      - email
      - tokenCaptcha
      type: object
      properties:
        email:
          type: string
        tokenCaptcha:
          type: string
        actionCaptcha:
          type: string
    RestorePasswordPostResponse:
      required:
      - message
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
    RestorePasswordPutResponse:
      required:
      - message
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
    RestorePasswordSetRequest:
      required:
      - email
      - password
      type: object
      properties:
        email:
          type: string
        password:
          type: string
    SessionResponse:
      required:
      - createdAt
      - email
      - message
      - phone
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        email:
          type: string
        phone:
          type: string
        createdAt:
          type: string
          format: date-time
    SignUpRequest:
      required:
      - actionCaptcha
      - email
      - password
      - tokenCaptcha
      type: object
      properties:
        email:
          type: string
        password:
          type: string
        tokenCaptcha:
          type: string
        actionCaptcha:
          type: string
    SmsRequest:
      required:
      - countryCode
      - phoneNumber
      type: object
      properties:
        countryCode:
          type: string
        phoneNumber:
          type: string
    SmsResponse:
      required:
      - countryCode
      - message
      - phoneNumber
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        countryCode:
          type: string
        phoneNumber:
          type: string
    SocialResponse:
      required:
      - message
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
    VerifyResponse:
      required:
      - message
      - success
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
    ErrorResponse_errors:
      type: object
      properties:
        field:
          type: string
        message:
          type: string
  securitySchemes:
    cookieAuth:
      type: apiKey
      name: ssid
      in: cookie
